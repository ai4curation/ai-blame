{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Home","text":""},{"location":"#ai-blame","title":"ai-blame","text":"<p>Extract provenance from AI agent execution traces.</p> <p>Like <code>git blame</code>, but for AI-assisted edits.</p>"},{"location":"#what-is-ai-blame","title":"What is ai-blame?","text":"<p>As AI agents increasingly assist with knowledge base curation, documentation, and code generation, we need to track provenance \u2014 which agent/model made what changes, when, and why.</p> <p><code>ai-blame</code> mines execution traces from AI coding assistants (currently Claude Code) and extracts a structured audit trail of file modifications. This history can be:</p> <ul> <li>Appended directly to YAML/JSON files as a <code>edit_history</code> section</li> <li>Written to sidecar files (e.g., <code>foo.history.yaml</code>)</li> <li>Embedded as comments in code files</li> </ul>"},{"location":"#quick-example","title":"Quick Example","text":"<pre><code># See what traces are available\nai-blame stats\n\n# Preview what would be added (dry run)\nai-blame mine --initial-and-recent\n\n# Actually apply changes\nai-blame mine --apply --initial-and-recent\n</code></pre> <p>This produces output like:</p> <pre><code># ... existing file content ...\n\nedit_history:\n  - timestamp: \"2025-12-01T08:03:42+00:00\"\n    model: claude-opus-4-5-20251101\n    agent_tool: claude-code\n    agent_version: \"2.0.75\"\n    action: CREATED\n  - timestamp: \"2025-12-15T20:34:29+00:00\"\n    model: claude-opus-4-5-20251101\n    agent_tool: claude-code\n    agent_version: \"2.1.0\"\n    action: EDITED\n</code></pre>"},{"location":"#key-features","title":"Key Features","text":"<ul> <li>Automatic trace discovery \u2014 Finds Claude Code traces based on your current directory</li> <li>Configurable output policies \u2014 Append, sidecar, or comment-based history</li> <li>Flexible filtering \u2014 By file pattern, change size, or time range</li> <li>Dry-run by default \u2014 Preview changes before applying</li> <li>Multiple file type support \u2014 YAML, JSON, Python, and more</li> </ul>"},{"location":"#supported-trace-sources","title":"Supported Trace Sources","text":"Agent Status Claude Code \u2705 Supported OpenAI Codex \ud83d\udd1c Planned Others (Cursor, Aider, etc.) PRs welcome!"},{"location":"#installation","title":"Installation","text":"<pre><code># Using uv (recommended)\nuv pip install ai-blame\n\n# Or from source\ngit clone https://github.com/ai4curation/ai-blame\ncd ai-blame\nuv sync\n</code></pre>"},{"location":"#next-steps","title":"Next Steps","text":"Getting Started New to ai-blame? Start here for a hands-on tutorial. Configuration Learn how to customize output policies for different file types. CLI Reference Complete reference for all commands and options. Philosophy Understand why provenance tracking matters."},{"location":"about/","title":"About ai-blame","text":"<p>Extract provenance from AI agent execution traces</p>"},{"location":"explanation/how-it-works/","title":"How It Works","text":"<p>This document explains the internal workings of <code>ai-blame</code>.</p>"},{"location":"explanation/how-it-works/#overview","title":"Overview","text":"<pre><code>flowchart LR\n    A[Claude Code Traces] --&gt; B[Extractor]\n    B --&gt; C[Edit Records]\n    C --&gt; D[Filters]\n    D --&gt; E[File Histories]\n    E --&gt; F[Updater]\n    F --&gt; G[Modified Files]</code></pre>"},{"location":"explanation/how-it-works/#step-1-locate-trace-files","title":"Step 1: Locate Trace Files","text":"<p>Claude Code stores execution traces in:</p> <pre><code>~/.claude/projects/&lt;encoded-cwd&gt;/\n</code></pre> <p>Where <code>&lt;encoded-cwd&gt;</code> is the project path with <code>/</code> replaced by <code>-</code>.</p> <p>Example:</p> Project Path Trace Directory <code>/Users/alice/myproject</code> <code>~/.claude/projects/-Users-alice-myproject/</code> <code>/home/bob/work/repo</code> <code>~/.claude/projects/-home-bob-work-repo/</code> <p>Each session generates a JSONL file (e.g., <code>a1b2c3d4-5678-90ab-cdef.jsonl</code>).</p>"},{"location":"explanation/how-it-works/#step-2-parse-trace-files","title":"Step 2: Parse Trace Files","text":"<p>Each trace file contains a sequence of JSON records representing the conversation and tool usage:</p> <pre><code>{\"type\": \"user\", \"uuid\": \"msg-1\", \"message\": {...}}\n{\"type\": \"assistant\", \"uuid\": \"msg-2\", \"message\": {...}, \"model\": \"claude-opus-4-5\"}\n{\"type\": \"user\", \"uuid\": \"msg-3\", \"toolUseResult\": {...}}\n</code></pre> <p>The extractor looks for successful Edit/Write operations by finding <code>toolUseResult</code> entries with:</p> <ul> <li>A <code>filePath</code> field</li> <li>Either <code>structuredPatch</code> (for edits) or <code>type: create</code> (for new files)</li> <li>No error indicators</li> </ul> <pre><code>def is_successful_edit(record: dict) -&gt; bool:\n    if record.get(\"type\") != \"user\":\n        return False\n\n    tool_result = record.get(\"toolUseResult\")\n    if not tool_result or not isinstance(tool_result, dict):\n        return False\n\n    if tool_result.get(\"is_error\") or tool_result.get(\"error\"):\n        return False\n\n    file_path = tool_result.get(\"filePath\", \"\")\n    if not file_path:\n        return False\n\n    has_patch = \"structuredPatch\" in tool_result\n    is_create = tool_result.get(\"type\") == \"create\"\n\n    return has_patch or is_create\n</code></pre>"},{"location":"explanation/how-it-works/#step-3-extract-metadata","title":"Step 3: Extract Metadata","text":"<p>For each successful edit, we extract:</p> Field Source <code>file_path</code> <code>toolUseResult.filePath</code> <code>timestamp</code> Record's <code>timestamp</code> field <code>model</code> Parent message's <code>message.model</code> <code>session_id</code> Record's <code>sessionId</code> <code>is_create</code> <code>toolUseResult.type == \"create\"</code> <code>change_size</code> Calculated from content/patch <code>agent_version</code> Record's <code>version</code> field <p>The model is found by looking up the parent message (the assistant message that invoked the tool).</p>"},{"location":"explanation/how-it-works/#step-4-apply-filters","title":"Step 4: Apply Filters","text":"<p>Filters reduce the volume of edit records:</p>"},{"location":"explanation/how-it-works/#file-pattern-filter","title":"File Pattern Filter","text":"<p>Keeps only files matching a substring:</p> <pre><code>if file_pattern and file_pattern not in file_path:\n    continue  # Skip this record\n</code></pre>"},{"location":"explanation/how-it-works/#time-range-filters","title":"Time Range Filters","text":"<pre><code>if config.since and edit.timestamp &lt; config.since:\n    continue\nif config.until and edit.timestamp &gt; config.until:\n    continue\n</code></pre>"},{"location":"explanation/how-it-works/#size-filter","title":"Size Filter","text":"<p>Skip small edits (likely typo fixes):</p> <pre><code>if config.min_change_size &gt; 0:\n    edits = [e for e in edits if e.change_size &gt;= config.min_change_size]\n</code></pre>"},{"location":"explanation/how-it-works/#initial-and-recent-only","title":"Initial and Recent Only","text":"<p>Keep only the first and last edit per file:</p> <pre><code>if config.initial_and_recent_only and len(edits) &gt; 2:\n    edits = [edits[0], edits[-1]]\n</code></pre>"},{"location":"explanation/how-it-works/#step-5-convert-to-file-histories","title":"Step 5: Convert to File Histories","text":"<p>Edit records are grouped by file and converted to <code>FileHistory</code> objects:</p> <pre><code>for abs_path, edits in edits_by_file.items():\n    rel_path = normalize_path(abs_path, repo_root)\n\n    events = []\n    for i, edit in enumerate(edits):\n        action = CurationAction.CREATED if (i == 0 and edit.is_create) else CurationAction.EDITED\n\n        events.append(CurationEvent(\n            timestamp=edit.timestamp,\n            model=edit.model,\n            action=action,\n            agent_tool=edit.agent_tool,\n            agent_version=edit.agent_version,\n        ))\n\n    histories[rel_path] = FileHistory(file_path=rel_path, events=events)\n</code></pre>"},{"location":"explanation/how-it-works/#step-6-load-output-configuration","title":"Step 6: Load Output Configuration","text":"<p>The configuration determines how each file type is handled:</p> <pre><code># Auto-find .ai-blame.yaml\nconfig_path = find_config()\nif config_path:\n    output_config = load_config(config_path)\nelse:\n    output_config = get_default_config()\n</code></pre> <p>Rules are matched using glob patterns:</p> <pre><code>def get_rule_for_file(self, path: str) -&gt; FileRule | None:\n    filename = Path(path).name\n\n    for rule in self.rules:\n        if \"/\" in rule.pattern or \"**\" in rule.pattern:\n            if fnmatch(path, rule.pattern):\n                return rule\n        else:\n            if fnmatch(filename, rule.pattern):\n                return rule\n\n    return self.defaults\n</code></pre>"},{"location":"explanation/how-it-works/#step-7-apply-changes","title":"Step 7: Apply Changes","text":"<p>Based on the output policy:</p>"},{"location":"explanation/how-it-works/#append-policy","title":"Append Policy","text":"<p>For YAML files, append a <code>edit_history</code> section:</p> <pre><code>curation_yaml = generate_curation_yaml(history)\nnew_content = content + \"\\n\" + curation_yaml\nfile_path.write_text(new_content)\n</code></pre> <p>If <code>edit_history</code> already exists, it's replaced.</p>"},{"location":"explanation/how-it-works/#sidecar-policy","title":"Sidecar Policy","text":"<p>Write to a companion file:</p> <pre><code>sidecar_path = resolve_sidecar_path(file_path, pattern)\n# e.g., main.py \u2192 main.history.yaml\n\nsidecar_data = {\n    \"source_file\": file_path.name,\n    \"edit_history\": events,\n}\nsidecar_path.write_text(yaml.dump(sidecar_data))\n</code></pre> <p>Existing sidecar files are merged (deduplicated by timestamp).</p>"},{"location":"explanation/how-it-works/#comment-policy","title":"Comment Policy","text":"<p>Embed as a comment block:</p> <pre><code>if syntax == CommentSyntax.HASH:\n    marker_start = \"# --- edit_history ---\"\n    marker_end = \"# --- end edit_history ---\"\n    commented = \"\\n\".join(f\"# {line}\" for line in history_yaml.split(\"\\n\"))\n\nnew_content = content + \"\\n\" + comment_block\n</code></pre>"},{"location":"explanation/how-it-works/#data-flow-summary","title":"Data Flow Summary","text":"<pre><code>flowchart TB\n    subgraph Input\n        T[Trace Files&lt;br&gt;~/.claude/projects/...]\n        C[Config File&lt;br&gt;.ai-blame.yaml]\n    end\n\n    subgraph Processing\n        E[Extractor&lt;br&gt;parse_trace_file]\n        F[Filter&lt;br&gt;apply_filters]\n        H[Converter&lt;br&gt;convert_to_file_histories]\n    end\n\n    subgraph Output\n        A[Append&lt;br&gt;YAML/JSON files]\n        S[Sidecar&lt;br&gt;*.history.yaml]\n        M[Comment&lt;br&gt;Code files]\n    end\n\n    T --&gt; E\n    E --&gt; F\n    F --&gt; H\n    C --&gt; R[Rule Matcher]\n    H --&gt; R\n    R --&gt;|append| A\n    R --&gt;|sidecar| S\n    R --&gt;|comment| M</code></pre>"},{"location":"explanation/philosophy/","title":"Philosophy","text":"<p>Why does <code>ai-blame</code> exist, and what problems does it solve?</p>"},{"location":"explanation/philosophy/#the-problem-ai-assisted-curation-at-scale","title":"The Problem: AI-Assisted Curation at Scale","text":"<p>AI agents are increasingly being used to assist with knowledge base curation, documentation maintenance, and code generation. Tools like Claude Code can create and modify dozens of files in a single session.</p> <p>But this raises a critical question: who made this change?</p> <p>Traditional version control (git) tells you what changed and when, but in an AI-assisted workflow, the commit author is a human even when an AI made the actual edit. This creates an attribution gap:</p> <pre><code>$ git log --oneline\na1b2c3d Add disease definitions (Alice)\nd4e5f6g Update phenotype mappings (Bob)\n</code></pre> <p>Both commits might have been AI-generated, but there's no way to tell:</p> <ul> <li>Which AI model was used?</li> <li>Was it created from scratch or edited from existing content?</li> <li>What version of the AI tool made the change?</li> </ul>"},{"location":"explanation/philosophy/#the-solution-embedded-provenance","title":"The Solution: Embedded Provenance","text":"<p><code>ai-blame</code> extracts provenance information from AI agent execution traces and embeds it directly in the affected files:</p> <pre><code># disease.yaml\nname: Asthma\ndefinition: A chronic respiratory condition...\n\nedit_history:\n  - timestamp: \"2025-12-01T08:03:42+00:00\"\n    model: claude-opus-4-5-20251101\n    agent_tool: claude-code\n    agent_version: \"2.0.75\"\n    action: CREATED\n</code></pre> <p>This provides:</p> <ol> <li>Attribution \u2014 Know which model made each change</li> <li>Traceability \u2014 Track the evolution of AI-curated content</li> <li>Reproducibility \u2014 Record the exact tool versions used</li> <li>Transparency \u2014 Make AI involvement visible and auditable</li> </ol>"},{"location":"explanation/philosophy/#design-principles","title":"Design Principles","text":""},{"location":"explanation/philosophy/#1-non-invasive","title":"1. Non-Invasive","text":"<p><code>ai-blame</code> works with existing files and doesn't require changes to your workflow. It reads execution traces that are already being generated by tools like Claude Code.</p>"},{"location":"explanation/philosophy/#2-flexible-output","title":"2. Flexible Output","text":"<p>Different file types need different approaches:</p> <ul> <li>Structured data (YAML, JSON) \u2014 Append a <code>edit_history</code> key</li> <li>Code files \u2014 Use sidecar files or embedded comments</li> <li>Documentation \u2014 Often best skipped</li> </ul> <p>The configuration system lets you define policies per file type.</p>"},{"location":"explanation/philosophy/#3-dry-run-by-default","title":"3. Dry-Run by Default","text":"<p>The tool never modifies files unless explicitly told to. This lets you preview changes and ensure they're correct before applying.</p>"},{"location":"explanation/philosophy/#4-minimal-footprint","title":"4. Minimal Footprint","text":"<p>With <code>--initial-and-recent</code>, you can keep only the first and last edit, avoiding bloated history sections while preserving the essential provenance information.</p>"},{"location":"explanation/philosophy/#use-cases","title":"Use Cases","text":""},{"location":"explanation/philosophy/#knowledge-base-curation","title":"Knowledge Base Curation","text":"<p>For projects like disease ontologies or gene annotations where AI agents assist curators:</p> <pre><code># kb/diseases/Asthma.yaml\nname: Asthma\nsynonyms:\n  - Bronchial asthma\n  - Hyperreactive airway disease\n\nedit_history:\n  - timestamp: \"2025-12-01T08:03:42+00:00\"\n    model: claude-opus-4-5-20251101\n    action: CREATED\n  - timestamp: \"2025-12-15T20:34:29+00:00\"\n    model: claude-opus-4-5-20251101\n    action: EDITED\n</code></pre>"},{"location":"explanation/philosophy/#ai-generated-code","title":"AI-Generated Code","text":"<p>Track which parts of your codebase were AI-generated:</p> <pre><code># utils.py\n\ndef calculate_statistics(data):\n    \"\"\"Calculate basic statistics for a dataset.\"\"\"\n    ...\n\n# --- edit_history ---\n# - timestamp: '2025-12-01T08:03:42+00:00'\n#   model: claude-opus-4-5-20251101\n#   action: CREATED\n# --- end edit_history ---\n</code></pre>"},{"location":"explanation/philosophy/#documentation","title":"Documentation","text":"<p>Use sidecar files to track AI involvement without cluttering docs:</p> <pre><code>docs/\n\u251c\u2500\u2500 guide.md\n\u251c\u2500\u2500 guide.history.yaml\n\u251c\u2500\u2500 reference.md\n\u2514\u2500\u2500 reference.history.yaml\n</code></pre>"},{"location":"explanation/philosophy/#relationship-to-version-control","title":"Relationship to Version Control","text":"<p><code>ai-blame</code> complements git, it doesn't replace it:</p> Aspect Git ai-blame Tracks File changes AI agent involvement Granularity Commits Individual tool operations Attribution Committer AI model + version Storage <code>.git/</code> history Embedded in files <p>The combination provides complete traceability:</p> <ol> <li>git \u2014 Who approved the change and when it was committed</li> <li>ai-blame \u2014 Which AI model made the change and how</li> </ol>"},{"location":"explanation/philosophy/#future-directions","title":"Future Directions","text":"<ul> <li>Multi-agent support \u2014 OpenAI Codex is planned; PRs welcome for other agents</li> <li>Semantic diff \u2014 Capture what changed, not just that it changed</li> <li>Verification \u2014 Cryptographic signatures for provenance data</li> <li>Integration \u2014 Hooks for CI/CD pipelines and documentation systems</li> </ul>"},{"location":"explanation/philosophy/#background","title":"Background","text":"<p>This project originated from discussions about AI-assisted curation workflows. See the original issue for context: ai4curation/aidocs#62</p>"},{"location":"explanation/related-tools/","title":"Related Tools","text":"<p>Several tools address the challenge of tracking AI contributions to codebases. This document compares different approaches and explains where <code>ai-blame</code> fits in the landscape.</p>"},{"location":"explanation/related-tools/#the-provenance-problem","title":"The Provenance Problem","text":"<p>As AI agents become routine collaborators in software development and knowledge curation, we face a new challenge: attribution. Traditional version control tells us who committed changes, but in an AI-assisted workflow, the human commits changes that an AI actually wrote.</p> <p>Different tools take different approaches to solving this.</p>"},{"location":"explanation/related-tools/#git-ai","title":"git-ai","text":"<p>Website: usegitai.com</p> <p>git-ai takes a git-native approach to AI attribution. Rather than modifying files, it extends git's metadata system.</p>"},{"location":"explanation/related-tools/#how-it-works","title":"How It Works","text":"<ol> <li> <p>Checkpoints: As you code with AI tools (Cursor, Claude Code, Copilot), git-ai creates temporary records in <code>.git/ai</code> marking which changes are AI-generated vs human-authored.</p> </li> <li> <p>Authorship Logs: At commit time, checkpoints become optimized logs mapping line ranges to their AI origin, stored as git notes.</p> </li> <li> <p>Blame Integration: Overlays AI authorship onto standard <code>git blame</code>, showing not just who last modified a line, but whether it originated from an AI.</p> </li> </ol>"},{"location":"explanation/related-tools/#key-strengths","title":"Key Strengths","text":"<ul> <li>Line-level granularity: Tracks individual lines, not just files</li> <li>Survives git operations: Rebases, merges, and cherry-picks preserve attribution</li> <li>Vendor neutral: Supports multiple AI tools</li> <li>Non-invasive: Metadata stays in <code>.git/</code>, files remain unchanged</li> </ul>"},{"location":"explanation/related-tools/#comparison-with-ai-blame","title":"Comparison with ai-blame","text":"Aspect git-ai ai-blame Granularity Line-level File-level Storage Git notes (<code>.git/</code>) Embedded in files Timing Real-time during coding Post-hoc extraction Portability Via git clone Files carry their history Use case Development workflows Knowledge bases, structured data"},{"location":"explanation/related-tools/#when-to-use-which","title":"When to Use Which","text":""},{"location":"explanation/related-tools/#use-git-ai-when","title":"Use git-ai when:","text":"<ul> <li>You need line-level attribution in code</li> <li>You want attribution to survive complex git workflows</li> <li>You prefer keeping files unchanged</li> <li>You're working in a typical software development context</li> </ul>"},{"location":"explanation/related-tools/#use-ai-blame-when","title":"Use ai-blame when:","text":"<ul> <li>You're curating knowledge bases or structured data (YAML, JSON)</li> <li>You want provenance embedded directly in files</li> <li>Files are distributed outside git (exports, APIs, publications)</li> <li>You need to extract provenance retroactively from existing traces</li> <li>You want history visible without special tooling</li> </ul>"},{"location":"explanation/related-tools/#complementary-usage","title":"Complementary Usage","text":"<p>The tools can complement each other:</p> <ul> <li>Use git-ai for your source code during development</li> <li>Use ai-blame for knowledge base files that get published or distributed</li> </ul> <p>For example, in a biomedical ontology project:</p> <pre><code>project/\n\u251c\u2500\u2500 src/                    # git-ai tracks code\n\u2502   \u2514\u2500\u2500 validators.py\n\u2514\u2500\u2500 kb/                     # ai-blame embeds history\n    \u2514\u2500\u2500 diseases/\n        \u2514\u2500\u2500 Asthma.yaml     # Contains edit_history\n</code></pre>"},{"location":"explanation/related-tools/#other-approaches","title":"Other Approaches","text":""},{"location":"explanation/related-tools/#manual-attribution","title":"Manual Attribution","text":"<p>Some teams add comments or commit message conventions:</p> <pre><code># AI-generated: Claude, 2025-01-15\ndef calculate_statistics(data):\n    ...\n</code></pre> <p>Pros: Simple, no tooling required Cons: Manual, inconsistent, doesn't scale</p>"},{"location":"explanation/related-tools/#ai-watermarking","title":"AI Watermarking","text":"<p>Some AI providers embed invisible watermarks in generated text.</p> <p>Pros: Automatic, detectable Cons: Can be stripped, not structured, privacy concerns</p>"},{"location":"explanation/related-tools/#trace-logging","title":"Trace Logging","text":"<p>Tools like LangSmith log AI interactions for debugging and monitoring.</p> <p>Pros: Rich context, debugging value Cons: Separate from files, requires infrastructure</p>"},{"location":"explanation/related-tools/#the-future","title":"The Future","text":"<p>As AI assistance becomes ubiquitous, we expect:</p> <ul> <li>Standardization: Common formats for AI provenance metadata</li> <li>Integration: IDEs and git hosts surfacing AI attribution natively</li> <li>Regulation: Requirements for AI disclosure in certain domains</li> </ul> <p>Both git-ai and ai-blame represent early attempts to build this infrastructure. The right tool depends on your workflow and what you're building.</p>"},{"location":"explanation/trace-format/","title":"Trace Format","text":"<p>This document explains the structure of Claude Code trace files that <code>ai-blame</code> parses.</p>"},{"location":"explanation/trace-format/#file-location","title":"File Location","text":"<p>Claude Code stores traces in:</p> <pre><code>~/.claude/projects/&lt;encoded-cwd&gt;/\n</code></pre> <p>Each session creates a JSONL file named with a UUID:</p> <pre><code>~/.claude/projects/-Users-alice-myproject/\n\u251c\u2500\u2500 a1b2c3d4-5678-90ab-cdef-123456789abc.jsonl\n\u251c\u2500\u2500 b2c3d4e5-6789-01cd-ef23-456789abcdef.jsonl\n\u2514\u2500\u2500 agent-c3d4e5f6-7890-12de-f345-6789abcdef01.jsonl\n</code></pre> <p>Files prefixed with <code>agent-</code> are from subagent invocations.</p>"},{"location":"explanation/trace-format/#jsonl-structure","title":"JSONL Structure","text":"<p>Each line is a JSON object representing a message in the conversation:</p> <pre><code>{\"type\": \"user\", \"uuid\": \"msg-1\", ...}\n{\"type\": \"assistant\", \"uuid\": \"msg-2\", ...}\n{\"type\": \"user\", \"uuid\": \"msg-3\", \"toolUseResult\": {...}}\n</code></pre>"},{"location":"explanation/trace-format/#message-types","title":"Message Types","text":""},{"location":"explanation/trace-format/#user-messages","title":"User Messages","text":"<p>Regular user input:</p> <pre><code>{\n  \"type\": \"user\",\n  \"uuid\": \"2447d793-4010-4028-bb03-b7d12f44f0a8\",\n  \"parentUuid\": null,\n  \"sessionId\": \"a1b2c3d4-5678-90ab-cdef\",\n  \"timestamp\": \"2025-12-22T17:09:15.442Z\",\n  \"cwd\": \"/Users/alice/myproject\",\n  \"version\": \"2.0.75\",\n  \"message\": {\n    \"role\": \"user\",\n    \"content\": \"Create a new config file\"\n  }\n}\n</code></pre>"},{"location":"explanation/trace-format/#assistant-messages","title":"Assistant Messages","text":"<p>Model responses, often containing tool use:</p> <pre><code>{\n  \"type\": \"assistant\",\n  \"uuid\": \"537588d8-3c9b-42a2-b0d0-55e9b57abe93\",\n  \"parentUuid\": \"2447d793-4010-4028-bb03-b7d12f44f0a8\",\n  \"sessionId\": \"a1b2c3d4-5678-90ab-cdef\",\n  \"timestamp\": \"2025-12-22T17:09:18.879Z\",\n  \"version\": \"2.0.75\",\n  \"message\": {\n    \"model\": \"claude-opus-4-5-20251101\",\n    \"role\": \"assistant\",\n    \"content\": [\n      {\n        \"type\": \"tool_use\",\n        \"id\": \"toolu_011MHKqGJhiXXZkWSrsTMwMp\",\n        \"name\": \"Write\",\n        \"input\": {\n          \"file_path\": \"/Users/alice/myproject/config.yaml\",\n          \"content\": \"name: myproject\\nversion: 1.0\\n\"\n        }\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"explanation/trace-format/#tool-results","title":"Tool Results","text":"<p>User messages containing <code>toolUseResult</code> are the results of tool invocations:</p> <pre><code>{\n  \"type\": \"user\",\n  \"uuid\": \"98506b67-b923-47a3-a6f0-f70771881aa0\",\n  \"parentUuid\": \"537588d8-3c9b-42a2-b0d0-55e9b57abe93\",\n  \"sessionId\": \"a1b2c3d4-5678-90ab-cdef\",\n  \"timestamp\": \"2025-12-22T17:09:19.998Z\",\n  \"version\": \"2.0.75\",\n  \"message\": {\n    \"role\": \"user\",\n    \"content\": [\n      {\n        \"tool_use_id\": \"toolu_011MHKqGJhiXXZkWSrsTMwMp\",\n        \"type\": \"tool_result\",\n        \"content\": \"File created successfully at: /Users/alice/myproject/config.yaml\"\n      }\n    ]\n  },\n  \"toolUseResult\": {\n    \"type\": \"create\",\n    \"filePath\": \"/Users/alice/myproject/config.yaml\",\n    \"content\": \"name: myproject\\nversion: 1.0\\n\"\n  }\n}\n</code></pre>"},{"location":"explanation/trace-format/#tool-result-types","title":"Tool Result Types","text":""},{"location":"explanation/trace-format/#file-creation-write","title":"File Creation (Write)","text":"<pre><code>{\n  \"toolUseResult\": {\n    \"type\": \"create\",\n    \"filePath\": \"/path/to/new_file.yaml\",\n    \"content\": \"file content here\",\n    \"structuredPatch\": []\n  }\n}\n</code></pre>"},{"location":"explanation/trace-format/#file-edit-edit","title":"File Edit (Edit)","text":"<pre><code>{\n  \"toolUseResult\": {\n    \"filePath\": \"/path/to/existing_file.yaml\",\n    \"oldString\": \"original text\",\n    \"newString\": \"modified text\",\n    \"structuredPatch\": [\n      {\n        \"oldStart\": 10,\n        \"oldLines\": 2,\n        \"newStart\": 10,\n        \"newLines\": 3,\n        \"lines\": [\" context\", \"-old line\", \"+new line\", \"+another new line\"]\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"explanation/trace-format/#error-results","title":"Error Results","text":"<p>Failed operations have error indicators:</p> <pre><code>{\n  \"toolUseResult\": {\n    \"is_error\": true,\n    \"error\": \"File not found: /path/to/missing.yaml\"\n  }\n}\n</code></pre> <p>Or HTTP-style error codes:</p> <pre><code>{\n  \"toolUseResult\": {\n    \"code\": 404,\n    \"message\": \"File not found\"\n  }\n}\n</code></pre>"},{"location":"explanation/trace-format/#key-fields-for-extraction","title":"Key Fields for Extraction","text":"<p><code>ai-blame</code> extracts these fields:</p> Field Location Description <code>file_path</code> <code>toolUseResult.filePath</code> Absolute path to the file <code>timestamp</code> Root <code>timestamp</code> When the operation occurred <code>model</code> Parent message's <code>message.model</code> Model identifier <code>session_id</code> Root <code>sessionId</code> Session identifier <code>is_create</code> <code>toolUseResult.type == \"create\"</code> Whether file was created <code>agent_version</code> Root <code>version</code> Claude Code version"},{"location":"explanation/trace-format/#parent-child-relationships","title":"Parent-Child Relationships","text":"<p>Messages are linked via <code>uuid</code> and <code>parentUuid</code>:</p> <pre><code>graph TD\n    A[User: Create config&lt;br&gt;uuid: msg-1] --&gt; B[Assistant: tool_use Write&lt;br&gt;uuid: msg-2&lt;br&gt;parentUuid: msg-1]\n    B --&gt; C[User: toolUseResult&lt;br&gt;uuid: msg-3&lt;br&gt;parentUuid: msg-2]</code></pre> <p>To find the model for a tool result:</p> <ol> <li>Get the <code>parentUuid</code> from the tool result message</li> <li>Look up the parent message by UUID</li> <li>Extract <code>message.model</code> from the parent</li> </ol>"},{"location":"explanation/trace-format/#other-record-types","title":"Other Record Types","text":"<p>The trace may contain other record types that <code>ai-blame</code> ignores:</p> <ul> <li><code>summary</code> \u2014 Session summary</li> <li><code>file-history-snapshot</code> \u2014 File state snapshots</li> <li>Encrypted thinking blocks \u2014 Lines starting with non-JSON characters</li> </ul>"},{"location":"explanation/trace-format/#example-trace","title":"Example Trace","text":"<pre><code>{\"type\":\"summary\",\"summary\":\"Create project configuration\"}\n{\"type\":\"user\",\"uuid\":\"msg-1\",\"message\":{\"role\":\"user\",\"content\":\"Create a config.yaml file\"},\"timestamp\":\"2025-12-22T17:09:15.442Z\",\"version\":\"2.0.75\",\"sessionId\":\"session-1\"}\n{\"type\":\"assistant\",\"uuid\":\"msg-2\",\"parentUuid\":\"msg-1\",\"message\":{\"model\":\"claude-opus-4-5-20251101\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_1\",\"name\":\"Write\",\"input\":{\"file_path\":\"/project/config.yaml\",\"content\":\"name: myproject\\n\"}}]},\"timestamp\":\"2025-12-22T17:09:18.879Z\",\"version\":\"2.0.75\",\"sessionId\":\"session-1\"}\n{\"type\":\"user\",\"uuid\":\"msg-3\",\"parentUuid\":\"msg-2\",\"toolUseResult\":{\"type\":\"create\",\"filePath\":\"/project/config.yaml\",\"content\":\"name: myproject\\n\"},\"timestamp\":\"2025-12-22T17:09:19.998Z\",\"version\":\"2.0.75\",\"sessionId\":\"session-1\"}\n</code></pre> <p>This trace shows:</p> <ol> <li>User requests a config file</li> <li>Assistant uses <code>Write</code> tool to create it</li> <li>Tool result confirms successful creation</li> </ol> <p><code>ai-blame</code> would extract:</p> <ul> <li>file_path: <code>/project/config.yaml</code></li> <li>timestamp: <code>2025-12-22T17:09:19.998Z</code></li> <li>model: <code>claude-opus-4-5-20251101</code></li> <li>is_create: <code>true</code></li> <li>agent_version: <code>2.0.75</code></li> </ul>"},{"location":"how-to/configuration/","title":"Configure Output Policies","text":"<p>This guide shows how to configure <code>ai-blame</code> to handle different file types with different output strategies.</p>"},{"location":"how-to/configuration/#the-configuration-file","title":"The Configuration File","text":"<p>Create a <code>.ai-blame.yaml</code> file in your project root:</p> <pre><code># .ai-blame.yaml\n\ndefaults:\n  policy: sidecar\n  sidecar_pattern: \"{stem}.history.yaml\"\n\nrules:\n  - pattern: \"*.yaml\"\n    policy: append\n\n  - pattern: \"*.yml\"\n    policy: append\n\n  - pattern: \"*.json\"\n    policy: append\n    format: json\n\n  - pattern: \"*.py\"\n    policy: comment\n    comment_syntax: hash\n\n  - pattern: \"*.md\"\n    policy: skip\n</code></pre>"},{"location":"how-to/configuration/#output-policies","title":"Output Policies","text":""},{"location":"how-to/configuration/#append-add-to-the-file","title":"<code>append</code> \u2014 Add to the File","text":"<p>Best for structured data files. Adds a <code>edit_history</code> key directly:</p> <pre><code>rules:\n  - pattern: \"*.yaml\"\n    policy: append\n</code></pre> <p>For JSON files, specify the format:</p> <pre><code>rules:\n  - pattern: \"*.json\"\n    policy: append\n    format: json\n</code></pre>"},{"location":"how-to/configuration/#sidecar-write-to-companion-file","title":"<code>sidecar</code> \u2014 Write to Companion File","text":"<p>Creates a separate history file alongside the original:</p> <pre><code>defaults:\n  policy: sidecar\n  sidecar_pattern: \"{stem}.history.yaml\"\n</code></pre> <p>Given <code>src/main.py</code>, this creates <code>src/main.history.yaml</code>.</p> <p>Sidecar pattern variables:</p> Variable Description Example <code>{name}</code> Full filename <code>main.py</code> <code>{stem}</code> Filename without extension <code>main</code> <code>{ext}</code> Extension with dot <code>.py</code> <code>{dir}</code> Parent directory <code>src</code> <p>Examples:</p> <pre><code># foo.py \u2192 foo.history.yaml\nsidecar_pattern: \"{stem}.history.yaml\"\n\n# foo.py \u2192 foo.py.history.yaml\nsidecar_pattern: \"{name}.history.yaml\"\n\n# foo.py \u2192 .history/foo.py.yaml\nsidecar_pattern: \".history/{name}.yaml\"\n</code></pre>"},{"location":"how-to/configuration/#comment-embed-as-comments","title":"<code>comment</code> \u2014 Embed as Comments","text":"<p>Adds history as a comment block at the end of the file:</p> <pre><code>rules:\n  - pattern: \"*.py\"\n    policy: comment\n    comment_syntax: hash\n\n  - pattern: \"*.js\"\n    policy: comment\n    comment_syntax: slash\n\n  - pattern: \"*.html\"\n    policy: comment\n    comment_syntax: html\n</code></pre> <p>Comment syntaxes:</p> Syntax Format <code>hash</code> <code># comment</code> <code>slash</code> <code>// comment</code> <code>html</code> <code>&lt;!-- comment --&gt;</code> <p>Result in a Python file:</p> <pre><code># ... your code ...\n\n# --- edit_history ---\n# - timestamp: '2025-12-01T08:03:42+00:00'\n#   model: claude-opus-4-5-20251101\n#   action: CREATED\n# --- end edit_history ---\n</code></pre>"},{"location":"how-to/configuration/#skip-ignore-files","title":"<code>skip</code> \u2014 Ignore Files","text":"<p>Don't process matching files:</p> <pre><code>rules:\n  - pattern: \"*.md\"\n    policy: skip\n\n  - pattern: \"tests/**\"\n    policy: skip\n</code></pre>"},{"location":"how-to/configuration/#rule-matching","title":"Rule Matching","text":"<p>Rules are evaluated in order \u2014 first match wins.</p> <pre><code>rules:\n  # Specific rule first\n  - pattern: \"config/*.yaml\"\n    policy: append\n\n  # Then general rule\n  - pattern: \"*.yaml\"\n    policy: sidecar\n</code></pre>"},{"location":"how-to/configuration/#pattern-syntax","title":"Pattern Syntax","text":"<ul> <li>Simple glob: <code>*.yaml</code>, <code>*.py</code></li> <li>Path patterns: <code>src/**/*.py</code>, <code>kb/*.yaml</code></li> <li>Filename patterns: <code>config.yaml</code>, <code>README.md</code></li> </ul> <p>For patterns without <code>/</code>, only the filename is matched. For patterns with <code>/</code> or <code>**</code>, the full path is matched.</p>"},{"location":"how-to/configuration/#specifying-config-file","title":"Specifying Config File","text":"<pre><code># Auto-find (walks up from cwd)\nai-blame mine\n\n# Explicit path\nai-blame mine --config /path/to/.ai-blame.yaml\n</code></pre>"},{"location":"how-to/configuration/#example-configurations","title":"Example Configurations","text":""},{"location":"how-to/configuration/#knowledge-base-project","title":"Knowledge Base Project","text":"<pre><code># Append history to knowledge files, skip everything else\ndefaults:\n  policy: skip\n\nrules:\n  - pattern: \"kb/**/*.yaml\"\n    policy: append\n</code></pre>"},{"location":"how-to/configuration/#python-library","title":"Python Library","text":"<pre><code># Sidecar for code, append for configs\ndefaults:\n  policy: sidecar\n  sidecar_pattern: \"{stem}.history.yaml\"\n\nrules:\n  - pattern: \"*.yaml\"\n    policy: append\n  - pattern: \"pyproject.toml\"\n    policy: skip\n  - pattern: \"tests/**\"\n    policy: skip\n</code></pre>"},{"location":"how-to/configuration/#mixed-project","title":"Mixed Project","text":"<pre><code>defaults:\n  policy: sidecar\n  sidecar_pattern: \".history/{name}.yaml\"\n\nrules:\n  - pattern: \"*.yaml\"\n    policy: append\n  - pattern: \"*.json\"\n    policy: append\n    format: json\n  - pattern: \"*.py\"\n    policy: comment\n    comment_syntax: hash\n  - pattern: \"*.js\"\n    policy: comment\n    comment_syntax: slash\n  - pattern: \"docs/**\"\n    policy: skip\n</code></pre>"},{"location":"how-to/file-types/","title":"Handle Different File Types","text":"<p>This guide shows recommended configurations for various file types.</p>"},{"location":"how-to/file-types/#structured-data-files","title":"Structured Data Files","text":""},{"location":"how-to/file-types/#yaml-files","title":"YAML Files","text":"<p>YAML files work best with the <code>append</code> policy:</p> <pre><code>rules:\n  - pattern: \"*.yaml\"\n    policy: append\n  - pattern: \"*.yml\"\n    policy: append\n</code></pre> <p>Result:</p> <pre><code># your-file.yaml\nname: Example\nversion: 1.0\n\nedit_history:\n  - timestamp: \"2025-12-01T08:03:42+00:00\"\n    model: claude-opus-4-5-20251101\n    action: CREATED\n</code></pre>"},{"location":"how-to/file-types/#json-files","title":"JSON Files","text":"<p>JSON files can also use <code>append</code> with the JSON format:</p> <pre><code>rules:\n  - pattern: \"*.json\"\n    policy: append\n    format: json\n</code></pre> <p>Result:</p> <pre><code>{\n  \"name\": \"Example\",\n  \"version\": \"1.0\",\n  \"edit_history\": [\n    {\n      \"timestamp\": \"2025-12-01T08:03:42+00:00\",\n      \"model\": \"claude-opus-4-5-20251101\",\n      \"action\": \"CREATED\"\n    }\n  ]\n}\n</code></pre>"},{"location":"how-to/file-types/#code-files","title":"Code Files","text":"<p>For code files, you have two options: sidecar files or embedded comments.</p>"},{"location":"how-to/file-types/#python","title":"Python","text":"Sidecar (Recommended)Comments <pre><code>rules:\n  - pattern: \"*.py\"\n    policy: sidecar\n    sidecar_pattern: \"{stem}.history.yaml\"\n</code></pre> <p>Creates <code>main.history.yaml</code> alongside <code>main.py</code>.</p> <pre><code>rules:\n  - pattern: \"*.py\"\n    policy: comment\n    comment_syntax: hash\n</code></pre> <p>Embeds at end of file: <pre><code># --- edit_history ---\n# - timestamp: '2025-12-01T08:03:42+00:00'\n#   model: claude-opus-4-5\n#   action: CREATED\n# --- end edit_history ---\n</code></pre></p>"},{"location":"how-to/file-types/#javascript-typescript","title":"JavaScript / TypeScript","text":"SidecarComments <pre><code>rules:\n  - pattern: \"*.js\"\n    policy: sidecar\n  - pattern: \"*.ts\"\n    policy: sidecar\n  - pattern: \"*.tsx\"\n    policy: sidecar\n</code></pre> <pre><code>rules:\n  - pattern: \"*.js\"\n    policy: comment\n    comment_syntax: slash\n  - pattern: \"*.ts\"\n    policy: comment\n    comment_syntax: slash\n</code></pre>"},{"location":"how-to/file-types/#html-xml","title":"HTML / XML","text":"<pre><code>rules:\n  - pattern: \"*.html\"\n    policy: comment\n    comment_syntax: html\n</code></pre> <p>Result:</p> <pre><code>&lt;!-- edit_history\n- timestamp: '2025-12-01T08:03:42+00:00'\n  model: claude-opus-4-5\n  action: CREATED\n--&gt;\n</code></pre>"},{"location":"how-to/file-types/#documentation-files","title":"Documentation Files","text":""},{"location":"how-to/file-types/#markdown","title":"Markdown","text":"<p>Markdown files are often regenerated or are documentation that shouldn't include audit trails:</p> <pre><code>rules:\n  - pattern: \"*.md\"\n    policy: skip\n  - pattern: \"docs/**\"\n    policy: skip\n</code></pre> <p>Or use sidecar if you want to track them:</p> <pre><code>rules:\n  - pattern: \"*.md\"\n    policy: sidecar\n</code></pre>"},{"location":"how-to/file-types/#configuration-files","title":"Configuration Files","text":""},{"location":"how-to/file-types/#skip-generatedlock-files","title":"Skip Generated/Lock Files","text":"<pre><code>rules:\n  - pattern: \"*.lock\"\n    policy: skip\n  - pattern: \"uv.lock\"\n    policy: skip\n  - pattern: \"package-lock.json\"\n    policy: skip\n</code></pre>"},{"location":"how-to/file-types/#track-project-configs","title":"Track Project Configs","text":"<pre><code>rules:\n  - pattern: \"pyproject.toml\"\n    policy: sidecar\n  - pattern: \"package.json\"\n    policy: append\n    format: json\n</code></pre>"},{"location":"how-to/file-types/#complete-example","title":"Complete Example","text":"<p>Here's a comprehensive configuration for a typical Python project:</p> <pre><code># .ai-blame.yaml\n\ndefaults:\n  policy: sidecar\n  sidecar_pattern: \"{stem}.history.yaml\"\n\nrules:\n  # Structured data - append directly\n  - pattern: \"*.yaml\"\n    policy: append\n  - pattern: \"*.yml\"\n    policy: append\n  - pattern: \"*.json\"\n    policy: append\n    format: json\n\n  # Skip documentation and tests\n  - pattern: \"*.md\"\n    policy: skip\n  - pattern: \"docs/**\"\n    policy: skip\n  - pattern: \"tests/**\"\n    policy: skip\n\n  # Skip generated files\n  - pattern: \"*.lock\"\n    policy: skip\n  - pattern: \".gitignore\"\n    policy: skip\n\n  # Python code - use sidecar (falls through to default)\n  # - pattern: \"*.py\"\n  #   policy: sidecar  # Uses default\n</code></pre>"},{"location":"how-to/file-types/#organizing-sidecar-files","title":"Organizing Sidecar Files","text":""},{"location":"how-to/file-types/#same-directory-default","title":"Same Directory (Default)","text":"<pre><code>sidecar_pattern: \"{stem}.history.yaml\"\n</code></pre> <pre><code>src/\n\u251c\u2500\u2500 main.py\n\u251c\u2500\u2500 main.history.yaml\n\u251c\u2500\u2500 utils.py\n\u2514\u2500\u2500 utils.history.yaml\n</code></pre>"},{"location":"how-to/file-types/#hidden-files","title":"Hidden Files","text":"<pre><code>sidecar_pattern: \".{stem}.history.yaml\"\n</code></pre> <pre><code>src/\n\u251c\u2500\u2500 main.py\n\u251c\u2500\u2500 .main.history.yaml\n\u251c\u2500\u2500 utils.py\n\u2514\u2500\u2500 .utils.history.yaml\n</code></pre>"},{"location":"how-to/file-types/#separate-directory","title":"Separate Directory","text":"<pre><code>sidecar_pattern: \".history/{name}.yaml\"\n</code></pre> <pre><code>src/\n\u251c\u2500\u2500 main.py\n\u251c\u2500\u2500 utils.py\n\u2514\u2500\u2500 .history/\n    \u251c\u2500\u2500 main.py.yaml\n    \u2514\u2500\u2500 utils.py.yaml\n</code></pre> <p>Tip</p> <p>Using a separate <code>.history/</code> directory keeps your source tree clean and makes it easy to <code>.gitignore</code> or include history files as needed.</p>"},{"location":"how-to/test-data/","title":"Work with Test Data","text":"<p>This guide shows how to use <code>ai-blame</code> with trace data from different locations, useful for testing or working with multiple projects.</p>"},{"location":"how-to/test-data/#the-problem","title":"The Problem","text":"<p>By default, <code>ai-blame</code> looks for traces based on your current working directory:</p> <pre><code>~/.claude/projects/-Users-you-current-project/\n</code></pre> <p>But sometimes you need to:</p> <ul> <li>Test with sample trace data</li> <li>Process traces from a different machine</li> <li>Work with traces stored in a non-standard location</li> </ul>"},{"location":"how-to/test-data/#using-dir-and-home","title":"Using <code>--dir</code> and <code>--home</code>","text":"<p>The <code>--dir</code> and <code>--home</code> options let you specify where to look for traces:</p> <pre><code># Look for traces as if you were in a different directory\nai-blame stats --dir /path/to/project\n\n# Look for traces in a different home directory\nai-blame stats --dir /path/to/project --home /other/home\n</code></pre>"},{"location":"how-to/test-data/#how-it-works","title":"How It Works","text":"<p>The trace directory is computed as:</p> <pre><code>$home/.claude/projects/&lt;encoded-dir&gt;/\n</code></pre> <p>Where <code>&lt;encoded-dir&gt;</code> is the directory path with <code>/</code> replaced by <code>-</code>.</p> <p>Example:</p> <pre><code>ai-blame stats --dir /Users/alice/myproject --home /Users/alice\n</code></pre> <p>Looks for traces in:</p> <pre><code>/Users/alice/.claude/projects/-Users-alice-myproject/\n</code></pre>"},{"location":"how-to/test-data/#testing-with-sample-data","title":"Testing with Sample Data","text":""},{"location":"how-to/test-data/#project-structure","title":"Project Structure","text":"<p>Set up test data like this:</p> <pre><code>tests/data/\n\u251c\u2500\u2500 .claude/\n\u2502   \u2514\u2500\u2500 projects/\n\u2502       \u2514\u2500\u2500 -Users-me-tests-data/\n\u2502           \u251c\u2500\u2500 session1.jsonl\n\u2502           \u2514\u2500\u2500 session2.jsonl\n\u251c\u2500\u2500 testdir1/\n\u2502   \u251c\u2500\u2500 foo.yaml\n\u2502   \u2514\u2500\u2500 bar.txt\n\u2514\u2500\u2500 testdir2/\n    \u2514\u2500\u2500 config.yaml\n</code></pre> <p>Note</p> <p>The encoded folder name must match the absolute path of your test data directory.</p>"},{"location":"how-to/test-data/#running-against-test-data","title":"Running Against Test Data","text":"<pre><code># From the project root\nai-blame stats --dir tests/data --home tests/data\n\n# Or with absolute paths\nai-blame stats \\\n  --dir /Users/me/project/tests/data \\\n  --home /Users/me/project/tests/data\n</code></pre>"},{"location":"how-to/test-data/#in-tests","title":"In Tests","text":"<pre><code>import pytest\nfrom pathlib import Path\nfrom typer.testing import CliRunner\nfrom ai_blame.cli import app\n\nrunner = CliRunner()\n\nTEST_DATA = Path(__file__).parent / \"data\"\n\ndef test_stats_with_test_data():\n    result = runner.invoke(\n        app,\n        [\n            \"stats\",\n            \"--dir\", str(TEST_DATA.resolve()),\n            \"--home\", str(TEST_DATA),\n        ],\n    )\n    assert result.exit_code == 0\n    assert \"Trace files:\" in result.output\n</code></pre>"},{"location":"how-to/test-data/#using-trace-dir-directly","title":"Using <code>--trace-dir</code> Directly","text":"<p>If you know the exact trace directory, use <code>--trace-dir</code>:</p> <pre><code>ai-blame stats --trace-dir ~/.claude/projects/-Users-alice-other-project/\n</code></pre> <p>This overrides <code>--dir</code> and <code>--home</code>.</p>"},{"location":"how-to/test-data/#priority-order","title":"Priority Order","text":"<ol> <li><code>--trace-dir</code> \u2014 Use this exact path</li> <li><code>--dir</code> + <code>--home</code> \u2014 Compute <code>$home/.claude/projects/&lt;encoded-dir&gt;/</code></li> <li>Default \u2014 Use <code>~/.claude/projects/&lt;encoded-cwd&gt;/</code></li> </ol>"},{"location":"how-to/test-data/#rewriting-trace-paths","title":"Rewriting Trace Paths","text":"<p>When copying traces between machines, file paths in the traces won't match. For testing, you may need to rewrite paths in the JSONL files:</p> <pre><code>def rewrite_trace_file(src: Path, dest: Path, old_path: str, new_path: str):\n    \"\"\"Rewrite a JSONL trace file, replacing path references.\"\"\"\n    with open(src) as f:\n        content = f.read()\n    content = content.replace(old_path, new_path)\n    with open(dest, \"w\") as f:\n        f.write(content)\n</code></pre> <p>This is what the test suite does to make traces portable across different machines.</p>"},{"location":"how-to/test-data/#example-cicd-testing","title":"Example: CI/CD Testing","text":"<pre><code># .github/workflows/test.yml\njobs:\n  test:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Test ai-blame\n        run: |\n          # Run against bundled test data\n          ai-blame stats --dir tests/data --home tests/data\n</code></pre>"},{"location":"reference/cli/","title":"CLI Reference","text":"<p>Complete reference for all <code>ai-blame</code> commands and options.</p>"},{"location":"reference/cli/#global-options","title":"Global Options","text":"<p>These options are available for all commands:</p> Option Description <code>--help</code> Show help message and exit"},{"location":"reference/cli/#commands","title":"Commands","text":""},{"location":"reference/cli/#ai-blame-mine","title":"<code>ai-blame mine</code>","text":"<p>Mine Claude Code traces and add edit history to files.</p> <pre><code>ai-blame mine [OPTIONS] [TARGET]\n</code></pre>"},{"location":"reference/cli/#arguments","title":"Arguments","text":"Argument Description <code>TARGET</code> Optional. Filter results to files matching this name (e.g., <code>Asthma.yaml</code>)"},{"location":"reference/cli/#options","title":"Options","text":"Option Short Default Description <code>--trace-dir</code> <code>-t</code> Auto Claude trace directory (overrides <code>--dir</code> and <code>--home</code>) <code>--dir</code> <code>-d</code> cwd Target project directory. Traces looked up in <code>$home/.claude/projects/&lt;encoded-dir&gt;/</code> <code>--home</code> <code>~</code> Home directory where <code>.claude/</code> lives <code>--config</code> <code>-c</code> Auto Config file path (default: auto-find <code>.ai-blame.yaml</code>) <code>--apply</code> <code>-a</code> False Actually apply changes (default is dry-run) <code>--initial-and-recent</code> <code>-ir</code> False Only keep first and last edit per file <code>--min-change-size</code> <code>-m</code> 0 Skip edits smaller than N characters <code>--pattern</code> <code>-p</code> Filter files by path pattern <code>--show-all</code> False Show all YAML previews (not just first 5)"},{"location":"reference/cli/#examples","title":"Examples","text":"<pre><code># Dry run for current directory\nai-blame mine\n\n# Preview with initial+recent filter\nai-blame mine --initial-and-recent\n\n# Apply changes\nai-blame mine --apply --initial-and-recent\n\n# Filter to YAML files only\nai-blame mine --pattern \".yaml\"\n\n# Process specific file\nai-blame mine config.yaml\n\n# Use explicit trace directory\nai-blame mine -t ~/.claude/projects/-Users-me-other-project/\n\n# Use different project directory\nai-blame mine --dir /path/to/project\n\n# Use test data\nai-blame mine --dir tests/data --home tests/data\n\n# Use custom config\nai-blame mine --config /path/to/.ai-blame.yaml\n</code></pre>"},{"location":"reference/cli/#ai-blame-stats","title":"<code>ai-blame stats</code>","text":"<p>Show statistics about available traces.</p> <pre><code>ai-blame stats [OPTIONS]\n</code></pre>"},{"location":"reference/cli/#options_1","title":"Options","text":"Option Short Default Description <code>--trace-dir</code> <code>-t</code> Auto Claude trace directory <code>--dir</code> <code>-d</code> cwd Target project directory <code>--home</code> <code>~</code> Home directory where <code>.claude/</code> lives <code>--pattern</code> <code>-p</code> Filter files by path pattern"},{"location":"reference/cli/#examples_1","title":"Examples","text":"<pre><code># Stats for current directory\nai-blame stats\n\n# Stats for specific project\nai-blame stats --dir /path/to/project\n\n# Stats for YAML files only\nai-blame stats --pattern \".yaml\"\n\n# Stats from test data\nai-blame stats --dir tests/data --home tests/data\n</code></pre>"},{"location":"reference/cli/#output","title":"Output","text":"<pre><code>Trace directory: /Users/you/.claude/projects/-Users-you-my-project\nTrace files: 12\n  Session traces: 8\n  Agent traces: 4\n\nFiles with edits (all files): 23\nTotal successful edits: 47\n</code></pre>"},{"location":"reference/cli/#trace-directory-resolution","title":"Trace Directory Resolution","text":"<p>The trace directory is determined by (in order of priority):</p> <ol> <li><code>--trace-dir</code>: Use this exact path</li> <li><code>--dir</code> + <code>--home</code>: Compute as <code>$home/.claude/projects/&lt;encoded-dir&gt;/</code></li> <li>Default: <code>~/.claude/projects/&lt;encoded-cwd&gt;/</code></li> </ol> <p>The <code>&lt;encoded-dir&gt;</code> is the directory path with <code>/</code> replaced by <code>-</code>.</p> <p>Example:</p> Directory Encoded <code>/Users/alice/project</code> <code>-Users-alice-project</code> <code>/home/bob/work/repo</code> <code>-home-bob-work-repo</code>"},{"location":"reference/cli/#exit-codes","title":"Exit Codes","text":"Code Meaning 0 Success 1 Error (e.g., trace directory not found, file not found)"},{"location":"reference/cli/#environment","title":"Environment","text":"<p><code>ai-blame</code> uses:</p> <ul> <li>Current working directory for default trace lookup</li> <li>User's home directory (<code>~</code>) for default <code>.claude/</code> location</li> <li><code>.ai-blame.yaml</code> configuration if present (searched upward from cwd)</li> </ul>"},{"location":"reference/config-file/","title":"Configuration File Reference","text":"<p>Complete reference for the <code>.ai-blame.yaml</code> configuration file.</p>"},{"location":"reference/config-file/#file-location","title":"File Location","text":"<p>The configuration file should be named <code>.ai-blame.yaml</code> and placed in your project root. <code>ai-blame</code> searches upward from the current directory to find it.</p> <p>You can also specify a config file explicitly:</p> <pre><code>ai-blame mine --config /path/to/.ai-blame.yaml\n</code></pre>"},{"location":"reference/config-file/#schema","title":"Schema","text":"<pre><code># .ai-blame.yaml\n\ndefaults:\n  policy: &lt;policy&gt;\n  format: &lt;format&gt;\n  sidecar_pattern: &lt;pattern&gt;\n  comment_syntax: &lt;syntax&gt;\n\nrules:\n  - pattern: &lt;glob&gt;\n    policy: &lt;policy&gt;\n    format: &lt;format&gt;\n    sidecar_pattern: &lt;pattern&gt;\n    comment_syntax: &lt;syntax&gt;\n</code></pre>"},{"location":"reference/config-file/#top-level-fields","title":"Top-Level Fields","text":""},{"location":"reference/config-file/#defaults","title":"<code>defaults</code>","text":"<p>Default rule applied when no other rule matches.</p> Field Type Default Description <code>policy</code> string <code>sidecar</code> Output policy <code>format</code> string <code>yaml</code> Output format for <code>append</code> policy <code>sidecar_pattern</code> string <code>{stem}.history.yaml</code> Pattern for sidecar filenames <code>comment_syntax</code> string Comment syntax for <code>comment</code> policy"},{"location":"reference/config-file/#rules","title":"<code>rules</code>","text":"<p>List of rules evaluated in order. First match wins.</p>"},{"location":"reference/config-file/#rule-fields","title":"Rule Fields","text":""},{"location":"reference/config-file/#pattern","title":"<code>pattern</code>","text":"<p>Required. Glob pattern to match files.</p> Pattern Type Example Matches Extension <code>*.yaml</code> Any YAML file Filename <code>config.yaml</code> Specific file Directory <code>kb/*.yaml</code> YAML files in <code>kb/</code> Recursive <code>src/**/*.py</code> Python files anywhere in <code>src/</code> <p>For patterns without <code>/</code>, only the filename is matched. For patterns with <code>/</code> or <code>**</code>, the full relative path is matched.</p>"},{"location":"reference/config-file/#policy","title":"<code>policy</code>","text":"<p>Required. How to write curation history.</p> Value Description <code>append</code> Add <code>edit_history</code> key directly to the file <code>sidecar</code> Write to a companion file <code>comment</code> Embed as comment block at end of file <code>skip</code> Don't process matching files"},{"location":"reference/config-file/#format","title":"<code>format</code>","text":"<p>Format for <code>append</code> policy output.</p> Value Description <code>yaml</code> YAML format (default) <code>json</code> JSON format"},{"location":"reference/config-file/#sidecar_pattern","title":"<code>sidecar_pattern</code>","text":"<p>Pattern for generating sidecar filenames. Only used with <code>sidecar</code> policy.</p> Variable Description Example Input Example Value <code>{name}</code> Full filename <code>main.py</code> <code>main.py</code> <code>{stem}</code> Filename without extension <code>main.py</code> <code>main</code> <code>{ext}</code> Extension with dot <code>main.py</code> <code>.py</code> <code>{dir}</code> Parent directory <code>src/main.py</code> <code>src</code> <p>Examples:</p> Pattern Input Output <code>{stem}.history.yaml</code> <code>main.py</code> <code>main.history.yaml</code> <code>{name}.history.yaml</code> <code>main.py</code> <code>main.py.history.yaml</code> <code>.history/{name}.yaml</code> <code>main.py</code> <code>.history/main.py.yaml</code> <code>.{stem}.history</code> <code>main.py</code> <code>.main.history</code>"},{"location":"reference/config-file/#comment_syntax","title":"<code>comment_syntax</code>","text":"<p>Comment syntax for <code>comment</code> policy.</p> Value Format Languages <code>hash</code> <code># comment</code> Python, Ruby, Shell, YAML <code>slash</code> <code>// comment</code> JavaScript, TypeScript, Go, Rust <code>html</code> <code>&lt;!-- comment --&gt;</code> HTML, XML, Markdown"},{"location":"reference/config-file/#complete-example","title":"Complete Example","text":"<pre><code># .ai-blame.yaml\n\n# Default: use sidecar files\ndefaults:\n  policy: sidecar\n  sidecar_pattern: \"{stem}.history.yaml\"\n\nrules:\n  # Structured data files - append directly\n  - pattern: \"*.yaml\"\n    policy: append\n\n  - pattern: \"*.yml\"\n    policy: append\n\n  - pattern: \"*.json\"\n    policy: append\n    format: json\n\n  # Knowledge base files - always track\n  - pattern: \"kb/**/*.yaml\"\n    policy: append\n\n  # Code files - embed as comments\n  - pattern: \"*.py\"\n    policy: comment\n    comment_syntax: hash\n\n  - pattern: \"*.js\"\n    policy: comment\n    comment_syntax: slash\n\n  - pattern: \"*.ts\"\n    policy: comment\n    comment_syntax: slash\n\n  # HTML files\n  - pattern: \"*.html\"\n    policy: comment\n    comment_syntax: html\n\n  # Skip these files\n  - pattern: \"*.md\"\n    policy: skip\n\n  - pattern: \"*.lock\"\n    policy: skip\n\n  - pattern: \"tests/**\"\n    policy: skip\n\n  - pattern: \"docs/**\"\n    policy: skip\n\n  - pattern: \".git/**\"\n    policy: skip\n</code></pre>"},{"location":"reference/config-file/#default-configuration","title":"Default Configuration","text":"<p>If no <code>.ai-blame.yaml</code> is found, the following defaults are used:</p> <pre><code>defaults:\n  policy: sidecar\n  sidecar_pattern: \"{stem}.history.yaml\"\n\nrules:\n  - pattern: \"*.yaml\"\n    policy: append\n\n  - pattern: \"*.yml\"\n    policy: append\n\n  - pattern: \"*.json\"\n    policy: append\n    format: json\n</code></pre> <p>This means:</p> <ul> <li>YAML files get history appended directly</li> <li>JSON files get history appended as JSON</li> <li>Everything else gets a sidecar file</li> </ul>"},{"location":"reference/config-file/#validation","title":"Validation","text":"<p>Invalid configurations will cause an error at runtime. Common issues:</p> <ul> <li>Missing <code>pattern</code> in a rule</li> <li>Invalid <code>policy</code> value (must be <code>append</code>, <code>sidecar</code>, <code>comment</code>, or <code>skip</code>)</li> <li>Missing <code>comment_syntax</code> when using <code>comment</code> policy</li> <li>Invalid YAML syntax</li> </ul>"},{"location":"reference/models/","title":"Data Models Reference","text":"<p>Reference documentation for all data models in <code>ai-blame</code>.</p>"},{"location":"reference/models/#curation-models","title":"Curation Models","text":""},{"location":"reference/models/#curationevent","title":"<code>CurationEvent</code>","text":"<p>A single curation event in the audit trail.</p> <pre><code>from ai_blame.models import CurationEvent, CurationAction\nfrom datetime import datetime, timezone\n\nevent = CurationEvent(\n    timestamp=datetime(2025, 12, 1, 8, 3, 42, tzinfo=timezone.utc),\n    model=\"claude-opus-4-5-20251101\",\n    action=CurationAction.CREATED,\n    agent_tool=\"claude-code\",\n    agent_version=\"2.0.75\",\n    description=\"Initial creation\",\n)\n</code></pre> Field Type Description <code>timestamp</code> <code>datetime</code> When the edit occurred <code>model</code> <code>str \\| None</code> Model identifier (e.g., <code>claude-opus-4-5-20251101</code>) <code>action</code> <code>CurationAction \\| None</code> Type of action (<code>CREATED</code> or <code>EDITED</code>) <code>agent_tool</code> <code>str \\| None</code> Tool that made the edit (e.g., <code>claude-code</code>) <code>agent_version</code> <code>str \\| None</code> Version of the agent tool <code>description</code> <code>str \\| None</code> Optional description of the change <p>Methods:</p> <pre><code># Convert to dictionary (for YAML/JSON output)\nevent.to_dict()\n# {'timestamp': '2025-12-01T08:03:42+00:00', 'model': 'claude-opus-4-5', ...}\n</code></pre>"},{"location":"reference/models/#curationaction","title":"<code>CurationAction</code>","text":"<p>Enum for curation action types.</p> <pre><code>from ai_blame.models import CurationAction\n\nCurationAction.CREATED  # File was created\nCurationAction.EDITED   # File was modified\n</code></pre>"},{"location":"reference/models/#filehistory","title":"<code>FileHistory</code>","text":"<p>Aggregated edit history for a single file.</p> <pre><code>from ai_blame.models import FileHistory\n\nhistory = FileHistory(\n    file_path=\"config.yaml\",\n    events=[event1, event2, event3],\n)\n\n# Properties\nhistory.first_edit  # datetime of first event\nhistory.last_edit   # datetime of last event\n</code></pre> Field Type Description <code>file_path</code> <code>str</code> Path to the file <code>events</code> <code>list[CurationEvent]</code> List of curation events Property Type Description <code>first_edit</code> <code>datetime \\| None</code> Timestamp of first event <code>last_edit</code> <code>datetime \\| None</code> Timestamp of last event"},{"location":"reference/models/#extraction-models","title":"Extraction Models","text":""},{"location":"reference/models/#editrecord","title":"<code>EditRecord</code>","text":"<p>A record of a successful file edit extracted from traces.</p> <pre><code>from ai_blame.models import EditRecord\nfrom datetime import datetime, timezone\n\nrecord = EditRecord(\n    file_path=\"/path/to/file.yaml\",\n    timestamp=datetime(2025, 12, 1, tzinfo=timezone.utc),\n    model=\"claude-opus-4-5-20251101\",\n    session_id=\"abc123\",\n    is_create=True,\n    change_size=150,\n    agent_tool=\"claude-code\",\n    agent_version=\"2.0.75\",\n)\n</code></pre> Field Type Description <code>file_path</code> <code>str</code> Absolute path to the file <code>timestamp</code> <code>datetime</code> When the edit occurred <code>model</code> <code>str</code> Model that made the edit <code>session_id</code> <code>str</code> Claude Code session ID <code>is_create</code> <code>bool</code> True if this was a file creation <code>change_size</code> <code>int</code> Approximate size of change in characters <code>agent_tool</code> <code>str</code> Tool identifier (default: <code>claude-code</code>) <code>agent_version</code> <code>str \\| None</code> Version of the agent tool"},{"location":"reference/models/#filterconfig","title":"<code>FilterConfig</code>","text":"<p>Configuration for filtering edit records.</p> <pre><code>from ai_blame.models import FilterConfig\nfrom datetime import datetime, timezone\n\nconfig = FilterConfig(\n    initial_and_recent_only=True,\n    min_change_size=50,\n    since=datetime(2025, 12, 1, tzinfo=timezone.utc),\n    until=datetime(2025, 12, 31, tzinfo=timezone.utc),\n    file_pattern=\".yaml\",\n)\n</code></pre> Field Type Default Description <code>initial_and_recent_only</code> <code>bool</code> <code>False</code> Keep only first and last edit per file <code>min_change_size</code> <code>int</code> <code>0</code> Minimum change size in characters <code>since</code> <code>datetime \\| None</code> <code>None</code> Only include edits after this time <code>until</code> <code>datetime \\| None</code> <code>None</code> Only include edits before this time <code>file_pattern</code> <code>str \\| None</code> <code>None</code> Filter by path substring"},{"location":"reference/models/#output-configuration-models","title":"Output Configuration Models","text":""},{"location":"reference/models/#outputpolicy","title":"<code>OutputPolicy</code>","text":"<p>Enum for output policies.</p> <pre><code>from ai_blame.models import OutputPolicy\n\nOutputPolicy.APPEND   # Add to file directly\nOutputPolicy.SIDECAR  # Write companion file\nOutputPolicy.COMMENT  # Embed as comment block\nOutputPolicy.SKIP     # Don't process\n</code></pre>"},{"location":"reference/models/#commentsyntax","title":"<code>CommentSyntax</code>","text":"<p>Enum for comment syntax styles.</p> <pre><code>from ai_blame.models import CommentSyntax\n\nCommentSyntax.HASH   # # comment\nCommentSyntax.SLASH  # // comment\nCommentSyntax.HTML   # &lt;!-- comment --&gt;\n</code></pre>"},{"location":"reference/models/#filerule","title":"<code>FileRule</code>","text":"<p>Rule for handling files matching a pattern.</p> <pre><code>from ai_blame.models import FileRule, OutputPolicy, CommentSyntax\n\n# Append to YAML files\nrule = FileRule(\n    pattern=\"*.yaml\",\n    policy=OutputPolicy.APPEND,\n)\n\n# Sidecar for Python files\nrule = FileRule(\n    pattern=\"*.py\",\n    policy=OutputPolicy.SIDECAR,\n    sidecar_pattern=\"{stem}.history.yaml\",\n)\n\n# Comment in JavaScript\nrule = FileRule(\n    pattern=\"*.js\",\n    policy=OutputPolicy.COMMENT,\n    comment_syntax=CommentSyntax.SLASH,\n)\n</code></pre> Field Type Default Description <code>pattern</code> <code>str</code> <code>\"*\"</code> Glob pattern to match <code>policy</code> <code>OutputPolicy</code> <code>APPEND</code> How to write history <code>format</code> <code>str</code> <code>yaml</code> Output format (<code>yaml</code> or <code>json</code>) <code>comment_syntax</code> <code>CommentSyntax \\| None</code> <code>None</code> Comment style for <code>COMMENT</code> policy <code>sidecar_pattern</code> <code>str \\| None</code> <code>None</code> Pattern for sidecar filenames"},{"location":"reference/models/#outputconfig","title":"<code>OutputConfig</code>","text":"<p>Complete output configuration with defaults and rules.</p> <pre><code>from ai_blame.models import OutputConfig, FileRule, OutputPolicy\n\nconfig = OutputConfig(\n    defaults=FileRule(\n        pattern=\"*\",\n        policy=OutputPolicy.SIDECAR,\n        sidecar_pattern=\"{stem}.history.yaml\",\n    ),\n    rules=[\n        FileRule(pattern=\"*.yaml\", policy=OutputPolicy.APPEND),\n        FileRule(pattern=\"*.json\", policy=OutputPolicy.APPEND, format=\"json\"),\n    ],\n)\n\n# Get rule for a file\nrule = config.get_rule_for_file(\"config.yaml\")\nprint(rule.policy)  # OutputPolicy.APPEND\n</code></pre> Field Type Description <code>defaults</code> <code>FileRule \\| None</code> Default rule when no rules match <code>rules</code> <code>list[FileRule]</code> Rules evaluated in order (first match wins) <p>Methods:</p> <pre><code># Get the applicable rule for a file path\nconfig.get_rule_for_file(\"path/to/file.py\") -&gt; FileRule | None\n</code></pre>"},{"location":"tutorials/getting-started/","title":"Getting Started","text":"<p>This tutorial walks you through using <code>ai-blame</code> to extract curation history from Claude Code traces and add it to your files.</p>"},{"location":"tutorials/getting-started/#prerequisites","title":"Prerequisites","text":"<ul> <li>Python 3.10+</li> <li>uv package manager (recommended)</li> <li>Claude Code installed and used on a project</li> </ul>"},{"location":"tutorials/getting-started/#installation","title":"Installation","text":"<pre><code># Install from PyPI\nuv pip install ai-blame\n\n# Or install from source\ngit clone https://github.com/ai4curation/ai-blame\ncd ai-blame\nuv sync\n</code></pre>"},{"location":"tutorials/getting-started/#step-1-check-your-traces","title":"Step 1: Check Your Traces","text":"<p>First, navigate to a project where you've used Claude Code:</p> <pre><code>cd /path/to/your/project\n</code></pre> <p>Then check what traces are available:</p> <pre><code>ai-blame stats\n</code></pre> <p>You should see output like:</p> <pre><code>Trace directory: /Users/you/.claude/projects/-Users-you-path-to-your-project\nTrace files: 12\n  Session traces: 8\n  Agent traces: 4\n\nFiles with edits (all files): 23\nTotal successful edits: 47\n</code></pre> <p>Where are traces stored?</p> <p>Claude Code stores execution traces in <code>~/.claude/projects/</code>. Each project has its own directory, named by encoding the project path (replacing <code>/</code> with <code>-</code>).</p>"},{"location":"tutorials/getting-started/#step-2-preview-changes-dry-run","title":"Step 2: Preview Changes (Dry Run)","text":"<p>By default, <code>ai-blame</code> runs in dry-run mode, showing what would happen without modifying files:</p> <pre><code>ai-blame mine\n</code></pre> <p>This displays:</p> <ol> <li>A summary table of all files with edit history</li> <li>YAML previews of the <code>edit_history</code> that would be added</li> </ol> <pre><code>=== Summary ===\nFile                                               | Edits | First Edit           | Last Edit\n--------------------------------------------------|-------|----------------------|--------------------\nconfig.yaml                                        |     3 | 2025-12-01 08:03     | 2025-12-15 20:34\ndata/entities.json                                 |     5 | 2025-12-02 14:22     | 2025-12-14 11:15\n\n=== YAML Preview: config.yaml ===\nedit_history:\n- timestamp: '2025-12-01T08:03:42+00:00'\n  model: claude-opus-4-5-20251101\n  agent_tool: claude-code\n  agent_version: '2.0.75'\n  action: CREATED\n...\n\n[DRY RUN] No files modified. Use --apply to actually update files.\n</code></pre>"},{"location":"tutorials/getting-started/#step-3-filter-the-results","title":"Step 3: Filter the Results","text":"<p>Often you'll want to reduce the verbosity. The <code>--initial-and-recent</code> flag keeps only the first and last edit per file:</p> <pre><code>ai-blame mine --initial-and-recent\n</code></pre> <p>You can also filter by file pattern:</p> <pre><code># Only YAML files\nai-blame mine --pattern \".yaml\"\n\n# Only files in a specific directory\nai-blame mine --pattern \"kb/\"\n\n# A specific file\nai-blame mine config.yaml\n</code></pre>"},{"location":"tutorials/getting-started/#step-4-apply-changes","title":"Step 4: Apply Changes","text":"<p>Once you're happy with the preview, apply the changes:</p> <pre><code>ai-blame mine --apply --initial-and-recent\n</code></pre> <p>Output:</p> <pre><code>Scanning traces in: /Users/you/.claude/projects/-Users-you-path-to-project\nUsing config: .ai-blame.yaml\n\n=== Summary ===\n...\n\nApplying changes...\n  Updated: config.yaml\n  Updated: data/entities.json\n</code></pre>"},{"location":"tutorials/getting-started/#step-5-verify-the-results","title":"Step 5: Verify the Results","text":"<p>Open one of the modified files. You should see a new <code>edit_history</code> section at the end:</p> <pre><code># config.yaml\nname: my-project\nversion: 1.0.0\n\nedit_history:\n  - timestamp: \"2025-12-01T08:03:42+00:00\"\n    model: claude-opus-4-5-20251101\n    agent_tool: claude-code\n    agent_version: \"2.0.75\"\n    action: CREATED\n  - timestamp: \"2025-12-15T20:34:29+00:00\"\n    model: claude-opus-4-5-20251101\n    agent_tool: claude-code\n    agent_version: \"2.1.0\"\n    action: EDITED\n</code></pre>"},{"location":"tutorials/getting-started/#next-steps","title":"Next Steps","text":"<ul> <li>Learn how to configure output policies for different file types</li> <li>Understand the CLI reference for all available options</li> <li>Read about how the extraction works</li> </ul>"},{"location":"tutorials/python-api/","title":"Python API","text":"<p>This tutorial shows how to use <code>ai-blame</code> programmatically in Python scripts.</p>"},{"location":"tutorials/python-api/#basic-usage","title":"Basic Usage","text":""},{"location":"tutorials/python-api/#extracting-edit-history","title":"Extracting Edit History","text":"<pre><code>from pathlib import Path\nfrom ai_blame.extractor import extract_edit_history, convert_to_file_histories\nfrom ai_blame.models import FilterConfig\n\n# Define the trace directory (or use default)\ntrace_dir = Path.home() / \".claude\" / \"projects\" / \"-Users-you-my-project\"\n\n# Extract all edits\nconfig = FilterConfig()\nedits_by_file = extract_edit_history(trace_dir, config)\n\n# See what files were edited\nfor file_path, edits in edits_by_file.items():\n    print(f\"{file_path}: {len(edits)} edits\")\n</code></pre>"},{"location":"tutorials/python-api/#filtering-results","title":"Filtering Results","text":"<pre><code>from datetime import datetime, timezone\n\n# Filter by file pattern\nconfig = FilterConfig(file_pattern=\".yaml\")\n\n# Filter by time range\nconfig = FilterConfig(\n    since=datetime(2025, 12, 1, tzinfo=timezone.utc),\n    until=datetime(2025, 12, 15, tzinfo=timezone.utc),\n)\n\n# Keep only first and last edit per file\nconfig = FilterConfig(initial_and_recent_only=True)\n\n# Skip small edits\nconfig = FilterConfig(min_change_size=100)\n</code></pre>"},{"location":"tutorials/python-api/#converting-to-file-histories","title":"Converting to File Histories","text":"<pre><code>from ai_blame.extractor import convert_to_file_histories, apply_filters\n\n# Apply post-extraction filters\nconfig = FilterConfig(initial_and_recent_only=True)\nfiltered_edits = apply_filters(edits_by_file, config)\n\n# Convert to FileHistory objects\nhistories = convert_to_file_histories(filtered_edits)\n\nfor path, history in histories.items():\n    print(f\"\\n{path}:\")\n    for event in history.events:\n        print(f\"  {event.timestamp}: {event.action} by {event.model}\")\n</code></pre>"},{"location":"tutorials/python-api/#working-with-configuration","title":"Working with Configuration","text":""},{"location":"tutorials/python-api/#loading-config-files","title":"Loading Config Files","text":"<pre><code>from ai_blame.config import find_config, load_config, get_default_config\n\n# Auto-find .ai-blame.yaml\nconfig_path = find_config()\nif config_path:\n    output_config = load_config(config_path)\nelse:\n    output_config = get_default_config()\n\n# Get rule for a specific file\nrule = output_config.get_rule_for_file(\"src/main.py\")\nprint(f\"Policy: {rule.policy}\")  # e.g., OutputPolicy.SIDECAR\n</code></pre>"},{"location":"tutorials/python-api/#creating-config-programmatically","title":"Creating Config Programmatically","text":"<pre><code>from ai_blame.models import OutputConfig, FileRule, OutputPolicy\n\nconfig = OutputConfig(\n    defaults=FileRule(\n        pattern=\"*\",\n        policy=OutputPolicy.SIDECAR,\n        sidecar_pattern=\"{stem}.history.yaml\",\n    ),\n    rules=[\n        FileRule(pattern=\"*.yaml\", policy=OutputPolicy.APPEND),\n        FileRule(pattern=\"*.json\", policy=OutputPolicy.APPEND, format=\"json\"),\n        FileRule(pattern=\"*.py\", policy=OutputPolicy.COMMENT, comment_syntax=\"hash\"),\n    ],\n)\n</code></pre>"},{"location":"tutorials/python-api/#updating-files","title":"Updating Files","text":""},{"location":"tutorials/python-api/#append-to-yaml","title":"Append to YAML","text":"<pre><code>from ai_blame.updater import append_yaml\n\nsuccess, result = append_yaml(\n    file_path=Path(\"config.yaml\"),\n    history=history,\n    dry_run=False,  # Set to True to preview\n)\n</code></pre>"},{"location":"tutorials/python-api/#write-sidecar-files","title":"Write Sidecar Files","text":"<pre><code>from ai_blame.updater import write_sidecar\n\nsuccess, result = write_sidecar(\n    file_path=Path(\"src/main.py\"),\n    history=history,\n    sidecar_pattern=\"{stem}.history.yaml\",\n    dry_run=False,\n)\n# Creates: src/main.history.yaml\n</code></pre>"},{"location":"tutorials/python-api/#embed-as-comments","title":"Embed as Comments","text":"<pre><code>from ai_blame.updater import write_comment\nfrom ai_blame.models import CommentSyntax\n\nsuccess, result = write_comment(\n    file_path=Path(\"script.py\"),\n    history=history,\n    syntax=CommentSyntax.HASH,\n    dry_run=False,\n)\n</code></pre>"},{"location":"tutorials/python-api/#apply-rules-automatically","title":"Apply Rules Automatically","text":"<pre><code>from ai_blame.updater import apply_rule\n\n# Get the rule for this file type\nrule = output_config.get_rule_for_file(\"data.json\")\n\n# Apply it\nsuccess, msg = apply_rule(\n    file_path=Path(\"data.json\"),\n    history=history,\n    rule=rule,\n    dry_run=False,\n)\n</code></pre>"},{"location":"tutorials/python-api/#complete-example","title":"Complete Example","text":"<pre><code>\"\"\"Extract and apply curation history to all YAML files in a project.\"\"\"\n\nfrom pathlib import Path\nfrom ai_blame.extractor import (\n    extract_edit_history,\n    apply_filters,\n    convert_to_file_histories,\n)\nfrom ai_blame.config import get_default_config\nfrom ai_blame.models import FilterConfig\nfrom ai_blame.updater import apply_rule\n\n\ndef main():\n    # Configuration\n    trace_dir = Path.home() / \".claude\" / \"projects\" / \"-Users-me-my-project\"\n\n    # Extract edits\n    filter_config = FilterConfig(\n        file_pattern=\".yaml\",\n        initial_and_recent_only=True,\n    )\n\n    edits = extract_edit_history(trace_dir, filter_config)\n    edits = apply_filters(edits, filter_config)\n    histories = convert_to_file_histories(edits)\n\n    # Get output config\n    output_config = get_default_config()\n\n    # Apply to each file\n    for rel_path, history in histories.items():\n        file_path = Path.cwd() / rel_path\n        if not file_path.exists():\n            print(f\"Skipping (not found): {rel_path}\")\n            continue\n\n        rule = output_config.get_rule_for_file(rel_path)\n        if rule is None:\n            continue\n\n        success, msg = apply_rule(file_path, history, rule, dry_run=False)\n        print(msg)\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorials/python-api/#data-models-reference","title":"Data Models Reference","text":"<p>See the Data Models Reference for complete documentation of all classes.</p>"}]}